# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on merge

on:
  push:
    branches:
      - main

jobs:
  notify-start:
    runs-on: ubuntu-latest
    steps:
      - name: Notify Telegram - Workflow Started
        run: |
          MESSAGE="ðŸš€ Um deploy do frontend do Tharseo foi iniciado... A previsÃ£o do tÃ©rmino Ã© de 2 minutos."
          curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d text="${MESSAGE}" \
            -d parse_mode="Markdown"

  build_and_deploy:
    needs: notify-start
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm ci --legacy-peer-deps && npm run build --legacy-peer-deps
      - uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_THARSEO_C8CB9 }}
          channelId: live
          projectId: tharseo-c8cb9

      - name: Notify Telegram - Deploy Success
        if: success()
        run: |
          MESSAGE="âœ… Deploy do frontend do Tharseo realizado com sucesso!"
          curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d text="${MESSAGE}" \
            -d parse_mode="Markdown"

      - name: Notify Telegram - Deploy Failure
        if: failure()
        run: |
          MESSAGE="ðŸš¨ Ocorreu um erro durante o deploy do frontend do Tharseo. Verifique os logs do actions para maiores informaÃ§Ãµes."
          curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d text="${MESSAGE}" \
            -d parse_mode="Markdown"
